{% extends 'correspondence/main_template.html' %} {% load static %}
{% block content %}
{% load crispy_forms_tags %}
<div class="card mb-4">
  <div class="card-header">Búsqueda de Usuario</div>
  <div class="card-body">
      <div class="row no-gutters">
        <div class="col-auto card-icon-aside md-4">
          <i class="feather-xl text-primary mb-3" data-feather="package"></i>
        </div>
        <div class="col">
          <div class="card-body py-5">
            <h1 class="card-title text-primary text-center">RINO PQRSD INFORMAR</h1>
          </div>
        </div>
        <div class="col-md-4">
          <img
            class="img-fluid"
            src="{% static 'correspondence/assets/img/illustrations/browser-stats.svg' %}"
            alt="..."
            style="width: 8rem"
          />
        </div>
      </div>
    <div class="row">
      <div class="tree">
        {% for item, info,last_leaf in functional_tree %}
        {% if info.open %}
        {% if info.level != 0 %}
        <div id="cont{{item.parent.id}}" class="collapse">
          {% endif %}
          <ul>
            <li>
              {% else %}
            </li>
            <li>
              {% endif %}
              {% if last_leaf %}
              <span style="color: #000;"><i class="fas fa-warehouse mr-1"></i><label
                  onclick="setSearch('{{item.pk}}', '{% url 'correspondence:users_by_area' %}')">
                  {{ item }}</label></span>
              {% else%}
              <span>
                <a style="color:#000; text-decoration:none;" data-toggle="collapse" href="#cont{{item.pk}}"
                  aria-expanded="false" aria-controls="cont{{item.pk}}">
                  <i class="collapsed">
                    <i class="fas fa-building"></i>
                  </i>
                  <i class="expanded">
                    <i class="far fa-building"></i>
                  </i>
                  {{ item }}
                </a>
              </span>
              {% endif %}

              {% for close in info.close %}
            </li>
          </ul>
          {% if info.level != 0 and info.open%}
        </div>
        {% endif%}
        {% endfor %}
        {% endfor %}
      </div>
    </div>
    <h5 class="mt-2 text-primary">Área seleccionada: <span id="headerForm">{{interest_area}}</span></h5>
    {% comment %} <input type="hidden" id="people_added" name="people_added" value="{{ people_added }}"> {% endcomment %}
    <form action="" method="post">
      {% csrf_token %}
      <select name="user_selected" id="user_selected">
      </select>
      <div class="col text-center">
        <input type="button" value="Agregar" class="btn btn-success lift" onclick="addPerson('{{interest_area}}')"/>
      </div>
      <div class="datatable">
          <table class="table table-bordered table-hover" id="people_list" width="100%" cellspacing='0'>
            <thead>
              <tr>
                <th style="text-align: center;">Usuario Informar</th>
                <th style="text-align: center;">Dependencia/Grupo</th>
                <th style="text-align: center;">Acción</th>
              </tr>
            </thead>
            <tbody>
              {% for person in people_added %}
              <tr>
                <td>
                 {{person.user.username}} {{ person.user.first_name }} {{ person.user.last_name}}
                </td>
                <td>
                {{person.area}}
                </td>
                <td>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      <input type="hidden" name="searchpk" id="searchpk" />
      <div class="col text-center">
        <input type="submit" name="search" value="Asignar" class="btn btn-success lift" />
        <a class="btn btn-primary" href="{% url 'pqrs:radicate_inbox' %}">Cancelar</a>
      </div>

    </form>
    <div class="alert alert-success mt-4" role="alert">
      <h4 class="alert-heading">Usuarios</h4>
      <p>{{rino_parameter}}</p>
    </div>
  </div>
</div>
{% endblock %}