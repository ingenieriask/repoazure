{% extends 'correspondence/main_template.html' %}

{% load static %}
{% block content %}
{% load pqrs_extras %}

<script src="{% static 'node_modules/jquery/dist/jquery.min.js' %}"></script>

  <div class="card mb-4">
      <div class="card-body">
        <div class="text-right m-2">
        </div>
        <div class="datatable">

          <div id="radicateList_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">

            <div class="row">
              <div id="keyword" class="mr-auto">
                <div id="radicateList_filter" class="dataTables_filter">
                  <label>
                    <input type="search" class="form-control form-control-sm" 
                    placeholder="Escriba una palabra clave para realizar la búsqueda..." aria-controls="radicateList">
                  </label>
                </div>
              </div>
              <div class="col-3">
                <div class="dataTables_length">
                  <form id="query" method="get">
                    <label>Mostrar 
                      <select id="radicateList_length" 
                        name="paginate_by" 
                        aria-controls="radicateList" 
                        class="custom-select custom-select-sm form-control form-control-sm">
                        {% for i in 20|page_range %}
                        <option value="{{ i }}" {% if paginator.per_page  == i %} selected {% endif %} >{{ i }}</option>
                        {% endfor %}
                      </select> 
                      registros
                    </label>
                  </form>
                </div>
              </div>
            </div>

            <div class="row">
              <table class="table table-bordered table-hover" id="radicateList" width="100%" cellspacing='0'>
                <thead>
                  <tr>
                    <th style="text-align: center;">Número de radicado</th>
                    <th style="text-align: center;">Fecha de radicación</th>
                    <th style="text-align: center;">Asunto</th>
                    <th style="text-align: center;">Solicitante</th>
                    <th style="text-align: center;">Tipo y Tema PQRSD</th>
                    <th style="text-align: center;">Días hábiles para dar respuesta</th>
                    <th style="text-align: center;">Estado</th>
                    <th style="text-align: center;">Detalles</th>
                  </tr>
                </thead>
                
                <tbody>
                  {% for pqrs in pqrs %}
                  <tr>
                    <td style="text-align: center;">{{ pqrs.number }}</td>
                    <td style="text-align: center;">{{ pqrs.date_radicated }}</td>
                    <td style="text-align: center;">{{ pqrs.subject }}</td>
                    {% if pqrs.person.is_anonymous == True %}
                        <td style="text-align: center;">ANÓNIMO</td>
                    {% else %}
                        <td style="text-align: center;">{{ pqrs.person.name }}</td>
                    {% endif %}
                    <td style="text-align: center;">{{ pqrs.subtype.type.name }} - {{ pqrs.subtype.name }}</td>
                    <td style="text-align: center;">
                        <svg height="8mm" width="8mm">
                          <circle cx="4mm" cy="4mm" r="3mm" style="fill: {{ pqrs.subtype.alerts.all|get_color_traffic_light:pqrs.date_radicated }};" />
                        </svg>
                        {{ pqrs.date_radicated|get_missing_days:pqrs.subtype.max_response_days }}    
                    </td>
                    <td style="text-align: center;">{{ pqrs.pqrsobject.get_status_str }}</td>
                    <td style="text-align: center;">
                        <a href="{% url 'pqrs:detail_pqr' pk=pqrs.pk  %}" role="button">
                          <i class="fas fa-plus-circle fa-2x" style="color: #0000ff;"></i>
                        </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <div class="row">
              <div class="col-sm-12 col-md-5">
              </div><div class="col-sm-12 col-md-7">
                <div class="dataTables_paginate paging_simple_numbers" id="radicateList_paginate">
                  <ul class="pagination">
                    <li class="paginate_button page-item previous {% if not page_obj.has_previous %} disabled {% endif %}" 
                      id="radicateList_previous">
                      <a {% if page_obj.has_previous %} href="?page={{ page_obj.previous_page_number }}" {% endif %} aria-controls="radicateList" data-dt-idx="0" tabindex="0" class="page-link">Anterior</a>
                    </li>
                    {% for i in paginator.page_range %}
                    <li class="paginate_button page-item {% if page_obj.number == i %} active {% endif %}">
                      <a href="?page={{i}}" aria-controls="radicateList" data-dt-idx="{{ i }}" tabindex="0" class="page-link">{{ i }}</a>
                    </li>
                    {% endfor %}
                    <li class="paginate_button page-item next {% if not page_obj.has_next %}disabled{% endif %}" 
                    id="radicateList_next">
                      <a {% if page_obj.has_next %} href="?page={{ page_obj.next_page_number }}" {% endif %} aria-controls="radicateList" data-dt-idx="2" tabindex="0" class="page-link">Siguiente</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    console.info('test')
  $("#radicateList_length").change(function() {
    console.info( "Handler for .change() called." );
    $("#query").submit();
  });
  </script>

{% endblock %}
