{% extends 'pqrs/template.html' %} {% load static %} {% load pqrs_extras %}
<!-- BLOCK Content -->
{% block content %}
<div class="row">
  <div class="col-xl-12 mb-12">
    <div class="card">
      <div class="card-body">

        <div class="col-4 offset-1">
          <div class="row"><h1>Desde - Hasta</h1></div>
          <div class="row">
            <div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
                <i class="fa fa-calendar"></i>&nbsp;
                <span></span> <i class="fa fa-caret-down"></i>
            </div>
          </div>
        </div>
 
        <div class="row no-gutters justify-content-center my-5">
            <h1 style='font-size: 4.5rem;'>Total PQRSD</h1>   
            <h1 style='font-size: 4.5rem; color:red;' class="ml-4">{{ pqrsds.count }}<h1>
        </div>
        <div class="row no-gutters justify-content-center">
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:#0080ff;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; font-weight:bold">PETICIONES</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color: #0080ff;">{{ petitions.count }}</h1>
                        <h1 style="color:green;">{% widthratio petitions.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:green;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; color:green; font-weight:bold">QUEJAS</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color:green;">{{ grievances.count }}</h1>
                        <h1 style="color:blue;">{% widthratio grievances.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:orange;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; color:orange; font-weight:bold">RECLAMOS</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color:orange;">{{ claims.count }}</h1>
                        <h1>{% widthratio claims.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:#00cfd5;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; color:#00cfd5; font-weight:bold">DENUNCIAS</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color:#00cfd5;">{{ complains.count }}</h1>
                        <h1 style="color:grey;">{% widthratio complains.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:red;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; color:red; font-weight:bold">SUGERENCIAS</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color:red;">{{ suggestions.count }}</h1>
                        <h1 style="color:blue;">{% widthratio suggestions.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <div class="card" style="max-width: 10rem; border-color:#cccc00;">
                    <div class="card-header text-center">
                        <p style="font-size: 0.8rem; color:#cccc00; font-weight:bold ">FELICITACIONES</p>
                    </div>
                    <div class="card-body text-center">
                        <h1 style="font-size:2.5rem; color:#cccc00;">{{ congratulations.count }}</h1>
                        <h1 style="color:#00cfd5;">{% widthratio congratulations.count pqrsds.count 100 %}%</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-5">
          <table class="table table-bordered table-hover" id="radicateList" width="100%" cellspacing='0'>
            <thead>
              <tr>
                <th style="text-align: center;">Número de radicado</th>
                <th style="text-align: center;">Fecha de radicación</th>
                <th style="text-align: center;">Asunto</th>
                <th style="text-align: center;">Solicitante</th>
                <th style="text-align: center;">Tipo y Tema PQRSD</th>
                <th style="text-align: center;">Días hábiles para dar respuesta</th>
                <th style="text-align: center;">Estado</th>
                <th style="text-align: center;">Unidad Administrativa</th>
              </tr>
            </thead>
            
            <tbody>
              {% for pqrs in pqrsds %}
              <tr>
                <td style="text-align: center;">{{ pqrs.number }}</td>
                <td style="text-align: center;">{{ pqrs.date_radicated }}</td>
                <td style="text-align: center;">{{ pqrs.subject }}</td>
                {% if pqrs.person.is_anonymous == True %}
                    <td style="text-align: center;">ANÓNIMO</td>
                {% elif pqrs.person %}
                    <td style="text-align: center;">{{ pqrs.person.name }}</td>
                {% else %}
                    <td style="text-align: center;">{{ pqrs.email_user_name }}</td>
                {% endif %}
                <td style="text-align: center;">{{ pqrs.subtype.type.name }} - {{ pqrs.subtype.name }}</td>
                <td style="text-align: center;">
                    <svg height="8mm" width="8mm">
                      <circle cx="4mm" cy="4mm" r="3mm" style="fill: {{ pqrs.subtype.alerts.all|get_color_traffic_light:pqrs.date_radicated }};" />
                    </svg>
                    {{ pqrs.date_radicated|get_missing_days:pqrs.subtype.max_response_days }}    
                </td>
                <td style="text-align: center;">{{ pqrs.pqrsobject.get_status_str }}</td>
                <td style="text-align: center;">

                  {% block actions %}
                  {% endblock %}
              </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-5"></div>
          <div class="col-sm-12 col-md-7">
            <div class="dataTables_paginate paging_simple_numbers" id="radicateList_paginate">
              <ul class="pagination">
                <li class="paginate_button page-item previous {% if not page_obj.has_previous %} disabled {% endif %}" 
                  id="radicateList_previous">
                  <a {% if page_obj.has_previous %} href="?page={{ page_obj.previous_page_number }}&filter={{ filter }}&paginate_by={{ paginator.per_page }}" {% endif %} aria-controls="radicateList" data-dt-idx="0" tabindex="0" class="page-link">Anterior</a>
                </li>
                {% for i in paginator.page_range %}
                <li class="paginate_button page-item {% if page_obj.number == i %} active {% endif %}">
                  <a href="?page={{i}}&filter={{ filter }}&paginate_by={{ paginator.per_page }}" aria-controls="radicateList" data-dt-idx="{{ i }}" tabindex="0" class="page-link">{{ i }}</a>
                </li>
                {% endfor %}
                <li class="paginate_button page-item next {% if not page_obj.has_next %}disabled{% endif %}" 
                id="radicateList_next">
                  <a {% if page_obj.has_next %} href="?page={{ page_obj.next_page_number }}&filter={{ filter }}&paginate_by={{ paginator.per_page }}" {% endif %} aria-controls="radicateList" data-dt-idx="2" tabindex="0" class="page-link">Siguiente</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div id="main" style="width: 600px;height:400px;"></div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
  $(function() {

    var start = moment().subtract(29, 'days');
    var end = moment();

    function cb(start, end) {
        $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }

    $('#reportrange').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
           'Today': [moment(), moment()],
           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
           'This Month': [moment().startOf('month'), moment().endOf('month')],
           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

    cb(start, end);

  });

  var myChart = echarts.init(document.getElementById('main'));

        // specify chart configuration item and data
        var option = {
            title: {
                text: 'ECharts entry example'
            },
            tooltip: {},
            legend: {
                data:['Sales']
            },
            xAxis: {
                data: ["shirt","cardign","chiffon shirt","pants","heels","socks"]
            },
            yAxis: {},
            series: [{
                name: 'Sales',
                type: 'bar',
                data: [5, 20, 36, 10, 10, 20]
            }]
        };

        // use configuration item and data specified to show chart
        myChart.setOption(option);
{% endblock %}